domain: identity
service: core

schema:
  phone: String
  email: String
  principle: String
  contexts: [String]

indexes:
  - phone
  - email

testing:
  examples:
    - action: add-contexts
      payload:
        contexts:
          - some-context
    - action: attempt-register
      payload:
        phone: "+19195551155"
        principle: some-principle
    - action: register
      payload:
        phone: "+19195551155"

  handlers:
    - action: attempt-register
      examples:
        - state:
            phone: "+19195551133"
          payload:
            phone: "+19195551144"
            principle: some-principle-root
          result:
            phone: "+19195551144"
            principle: some-principle-root
    - action: register
      examples:
        - state:
            phone: "+19195551133"
          payload:
            phone: "+19195551144"
          result:
            phone: "+19195551144"
    - action: add-contexts
      examples:
        - state:
            contexts:
              - some-context
          payload:
            contexts:
              - some-other-context
          result:
            contexts:
              - some-context
              - some-other-context

#don't change
context: event-store
